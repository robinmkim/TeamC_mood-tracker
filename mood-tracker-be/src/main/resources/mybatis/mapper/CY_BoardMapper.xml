<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.teamc.moodtracker.dao.CY_BoardDao">
    <!-- 감정 & 감정 수-->
    <select id="getSentiment" resultType="map" >
        select b_sentiment, count(*) as cnt from board where m_id=#{mid} group by b_sentiment
    </select>

    <!--내 게시글 리스트-->
    <select id="getMyBoardList" parameterType="map" resultType="java.lang.Integer">
        SELECT b.b_id
        FROM board b
        WHERE b.m_id = #{mid} and (SELECT COUNT(*) FROM board WHERE m_id=#{mid} and b_id > b.b_id) BETWEEN #{lastRowNum} AND (#{lastRowNum} + 4)
        ORDER BY b.regdate DESC
    </select>

    <!--내가 좋아요 한 게시글 리스트-->
    <select id="getLikedBoardList" parameterType="map" resultType="java.lang.Integer">
        select b.b_id from board b
        join board_like l on b.b_id = l.blike_bid
        where l.blike_user = #{mid} and (
        select count(*) from board_like l join board bb on l.blike_bid = bb.b_id
        where l.blike_user=#{mid} and bb.b_id > b.b_id)
        between #{lastRowNum} and (#{lastRowNum} + 4)
        order by b.regdate desc
    </select>
    <!-- 날짜를 기준으로 게시글 디테일-->
    <select id="getListByDate" parameterType="map" resultType="java.lang.Integer">
        select b_id from board where m_id=#{mid} and trunc(regdate) = #{regdate} order by b_id desc
    </select>

    <resultMap id="BoardWithMediaResultMap" type="cbvo">
        <id property="b_id" column="b_id"/>
        <result property="m_id" column="m_id"/>
        <result property="b_content" column="b_content"/>
        <result property="b_sentiment" column="b_sentiment"/>
        <result property="regdate" column="regdate"/>
        <collection property="mediaList" ofType="mdto">
            <id property="md_id" column="md_id"/>
            <result property="md_name" column="md_name"/>
            <result property="md_path" column="md_path"/>
            <result property="md_type" column="md_type"/>
        </collection>
    </resultMap>

    <select id="getMyBoardDetail" resultMap="BoardWithMediaResultMap">

    </select>

    <!--해당 게시글에 좋아요를 누른 사람들-->

</mapper>